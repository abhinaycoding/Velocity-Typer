<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velocity Typer</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&family=Plus+Jakarta+Sans:wght@300;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --neon-cyan: #00f3ff;
            --neon-pink: #ff003c;
            --cyber-yellow: #fcee0a;
        }

        body { background: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; touch-action: manipulation; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        #bg-canvas { position: fixed; inset: 0; z-index: -1; filter: blur(100px); opacity: 0.6; pointer-events: none; }
        .blob { position: absolute; border-radius: 50%; mix-blend-mode: screen; will-change: transform, filter; }

        .glass { 
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(40px); 
            border: 1px solid rgba(0, 243, 255, 0.2); 
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.05);
        }
        
        #test-area { 
            position: relative; width: 100%; max-width: 900px; z-index: 10; height: 320px; 
            display: flex; align-items: flex-start; overflow: hidden; 
        }

        #test-area::before {
            content: ""; position: absolute; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 243, 255, 0.03) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 20;
        }

        #text-display { font-size: 1.4rem; color: rgba(255,255,255,0.15); text-align: left; width: 100%; position: relative; transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1); padding-bottom: 50px; }
        @media (min-width: 768px) { #text-display { font-size: 1.8rem; } }
        
        #text-display span { position: relative; display: inline-block; white-space: pre; transition: all 0.2s; vertical-align: top; }
        
        .correct { color: var(--neon-cyan); text-shadow: 0 0 12px var(--neon-cyan); }
        .wrong { color: var(--neon-pink); background: rgba(255, 0, 60, 0.2); border-radius: 4px; animation: shake 0.2s; text-shadow: 0 0 10px var(--neon-pink); }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } }
        
        #caret { position: absolute; width: 2px; background: var(--neon-cyan); box-shadow: 0 0 15px var(--neon-cyan); z-index: 5; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        
        #main-input { position: absolute; opacity: 0; pointer-events: none; }

        .footer-controls { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 100; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .mode-btn { padding: 6px 12px; border-radius: 8px; font-size: 9px; font-weight: bold; border: 1px solid rgba(255,255,255,0.1); color: #666; cursor: pointer; transition: 0.3s; }
        .mode-btn.active { background: var(--neon-cyan); color: #000; border-color: var(--neon-cyan); box-shadow: 0 0 15px rgba(0, 243, 255, 0.4); }
        .action-btn { padding: 10px 20px; border-radius: 10px; font-size: 10px; font-weight: 800; text-transform: uppercase; border: 1px solid rgba(0, 243, 255, 0.3); cursor: pointer; color: var(--neon-cyan); transition: 0.3s; }
        .action-btn:hover { background: var(--neon-cyan); color: #000; box-shadow: 0 0 20px var(--neon-cyan); }
        
        .credits a { position: relative; z-index: 200; pointer-events: auto; text-decoration: underline; color: rgba(255,255,255,0.5); transition: 0.3s; }
        .credits a:hover { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); }

        #intro-overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .cyber-glitch { font-size: 4rem; font-weight: 900; font-style: italic; text-transform: uppercase; color: #fff; animation: intro-glitch 725ms infinite; }
        @keyframes intro-glitch {
            0% { text-shadow: 2px 0 0 var(--neon-cyan), -2px -2px 0 var(--neon-pink); }
            50% { text-shadow: -2px 2px 0 var(--neon-cyan), 2px 0 0 var(--neon-pink); }
            100% { text-shadow: 2px -2px 0 var(--neon-cyan), -1px 2px 0 var(--neon-pink); }
        }

        #report-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .report-card { width: 90%; max-width: 600px; padding: 40px; border-radius: 30px; text-align: center; border: 1px solid var(--neon-cyan); }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen p-4">

    <div id="intro-overlay">
        <h1 class="cyber-glitch">Velocity Typer</h1>
        <div class="mt-4 text-[10px] tracking-[0.8em] text-cyan-400 uppercase font-black opacity-0" id="intro-sub">Initializing Neural Interface...</div>
        <div class="w-48 h-[1px] bg-white/10 mt-8 relative overflow-hidden">
            <div id="intro-progress" class="absolute inset-0 bg-cyan-400 translate-x-[-100%]"></div>
        </div>
    </div>

    <div id="bg-canvas">
        <div class="blob w-[30rem] h-[30rem] bg-[#00f3ff]/30" style="top: 0%; left: 0%;"></div>
        <div class="blob w-[35rem] h-[35rem] bg-[#ff003c]/20" style="bottom: 0%; right: 0%;"></div>
        <div class="blob w-[20rem] h-[20rem] bg-[#fcee0a]/10" style="top: 30%; left: 40%;"></div>
    </div>

    <input type="text" id="main-input" autofocus autocomplete="off">

    <div class="fixed top-6 flex flex-col items-center gap-4 w-full px-4" style="z-index: 50;">
        <div class="flex flex-wrap justify-center gap-2 p-1 glass rounded-xl">
            <button onclick="setMode('short')" id="btn-short" class="mode-btn active">Warmup</button>
            <button onclick="setMode('javascript')" id="btn-javascript" class="mode-btn">JS</button>
            <button onclick="setMode('cpp')" id="btn-cpp" class="mode-btn">C++</button>
        </div>
        
        <div class="flex gap-10">
            <div class="flex flex-col items-center">
                <span class="text-[8px] tracking-[0.3em] text-cyan-500 uppercase font-black">Streak</span>
                <h2 id="streak-display" class="text-3xl font-black italic text-white">0</h2>
            </div>
            <div class="flex flex-col items-center">
                <span class="text-[8px] tracking-[0.3em] text-gray-500 uppercase font-black">Words Left</span>
                <h2 id="words-left-display" class="text-3xl font-black italic">0</h2>
            </div>
        </div>
    </div>

    <div id="test-area" class="glass p-8 md:p-12 rounded-[2rem] w-full border-white/5 shadow-2xl">
        <div id="text-display" class="mono font-medium">
            <div id="caret"></div>
            <div id="words-wrapper"></div>
        </div>
    </div>

    <div class="footer-controls">
        <div class="control-group glass p-2 rounded-xl flex items-center gap-4 border border-white/10 px-4">
            <span class="text-[9px] font-bold uppercase text-cyan-500">Limit</span>
            <select id="word-limit" class="bg-transparent text-white font-bold outline-none cursor-pointer" onchange="init()">
                <option value="25" class="bg-black">25 Words</option>
                <option value="50" class="bg-black">50 Words</option>
                <option value="100" class="bg-black">100 Words</option>
            </select>
        </div>
        
        <div class="flex flex-col items-center gap-4">
            <div class="flex gap-3">
                <button onclick="init()" class="action-btn glass">Restart</button>
                <button onclick="changeText()" class="action-btn glass">New Text</button>
            </div>
            <div class="credits text-[8px] uppercase tracking-[2px] text-white/30">
                Created by <a href="https://www.linkedin.com/in/abhinay-nachankar-36b3a7223/" target="_blank">Abhinay Nachankar</a>
            </div>
        </div>

        <div class="control-group glass p-2 rounded-xl flex items-center gap-4 border border-white/10 px-4">
            <span class="text-[9px] font-bold text-gray-500 uppercase">Vol</span>
            <input type="range" id="vol-slider" min="0" max="0.1" step="0.01" value="0.03" class="accent-cyan-500">
        </div>
    </div>

    <div id="report-modal">
        <div class="glass report-card">
            <h1 class="text-xs font-black tracking-[0.5em] text-cyan-400 uppercase mb-6">Neural Performance Report</h1>
            <div class="flex justify-around mb-8">
                <div><h2 id="final-wpm" class="text-4xl font-black italic text-white">0</h2><p class="text-[10px] text-gray-500 uppercase">WPM</p></div>
                <div><h2 id="final-acc" class="text-4xl font-black italic text-white">0%</h2><p class="text-[10px] text-gray-500 uppercase">Accuracy</p></div>
            </div>
            <div class="h-40 w-full mb-8">
                <canvas id="wpmChart"></canvas>
            </div>
            <button onclick="init()" class="w-full py-4 bg-cyan-400 text-black rounded-xl font-black uppercase text-xs tracking-widest hover:scale-[0.98] transition-all">Next Stream</button>
        </div>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const volSlider = document.getElementById('vol-slider');
        const wordLimit = document.getElementById('word-limit');
        const wordsLeftDisplay = document.getElementById('words-left-display');
        const streakDisplay = document.getElementById('streak-display');
        const wrapper = document.getElementById('words-wrapper'), input = document.getElementById('main-input'), caret = document.getElementById('caret');
        
        let currentMode = 'short', targetText = "", charIndex = 0, startTime = null, errors = 0, streak = 0;
        let wpmHistory = [], chartInstance = null, timerInterval;

        function startCyberBg() {
            const blobs = document.querySelectorAll('.blob');
            blobs.forEach(blob => {
                gsap.to(blob, {
                    x: "random(-200, 200)", y: "random(-200, 200)",
                    duration: "random(6, 12)", repeat: -1, yoyo: true, ease: "sine.inOut"
                });
                setInterval(() => {
                    if(Math.random() > 0.85) {
                        gsap.to(blob, {
                            scale: 1.15, filter: "blur(130px) brightness(1.6)",
                            duration: 0.1, yoyo: true, repeat: 1, ease: "steps(1)"
                        });
                    }
                }, 3000);
            });
        }

        window.addEventListener('load', () => {
            const tl = gsap.timeline();
            tl.to("#intro-sub", { opacity: 1, duration: 0.5 })
              .to("#intro-progress", { x: "0%", duration: 1.5, ease: "power2.inOut" })
              .to("#intro-overlay", { y: "-100%", duration: 1.2, ease: "expo.inOut", onComplete: () => {
                  document.getElementById('intro-overlay').style.display = 'none';
                  input.focus();
                  startCyberBg();
              }});
        });

        const library = {
            short: [
                "You do not rise to the level of your goals, you fall to the level of your systems.",
                "It is the possibility of having a dream come true that makes life interesting.",
                "When you want something, all the universe conspires in helping you to achieve it.",
                "Focus on being productive instead of being busy.",
                "Your time is limited, so do not waste it living someone else's life."
            ],
            javascript: [
                "const unique = [...new Set(array)];",
                "const data = await response.json();",
                "export default function App() { return <div>Hello</div>; }",
                "arr.reduce((acc, curr) => acc + curr, 0);"
            ],
            cpp: [
                "#include <iostream> using namespace std; int main() { return 0; }",
                "std::vector<int> numbers = {1, 2, 3, 4, 5};",
                "template <typename T> T max(T a, T b) { return (a > b) ? a : b; }",
                "int* ptr = new int(10); delete ptr; ptr = nullptr;"
            ]
        };

        function setMode(m) {
            currentMode = m;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${m}`).classList.add('active');
            init();
        }

        function generateText() {
            const limit = parseInt(wordLimit.value);
            const snippets = library[currentMode] || library.short;
            let resultArr = [];
            let pool = [...snippets].sort(() => Math.random() - 0.5);
            let i = 0;
            while(resultArr.join(" ").split(/\s+/).length < limit) {
                resultArr.push(pool[i % pool.length]);
                i++;
            }
            return resultArr.join(" ").split(/\s+/).slice(0, limit).join(" ");
        }

        function changeText() {
            gsap.to("#test-area", { 
                opacity: 0.5, 
                x: "random(-10, 10)", 
                duration: 0.05, 
                repeat: 3, 
                yoyo: true, 
                onComplete: () => {
                    gsap.to("#test-area", { opacity: 1, x: 0 });
                    init();
                }
            });
        }

        function init() {
            document.getElementById('report-modal').style.display = 'none';
            clearInterval(timerInterval);
            targetText = generateText();
            wrapper.innerHTML = targetText.split('').map(char => `<span>${char === ' ' ? '&nbsp;' : char}</span>`).join('');
            charIndex = 0; errors = 0; streak = 0; startTime = null; input.value = ""; wpmHistory = [];
            wordsLeftDisplay.innerText = targetText.split(/\s+/).length;
            streakDisplay.innerText = "0";
            input.focus();
            positionCaret();
        }

        function positionCaret() {
            const spans = wrapper.querySelectorAll('span');
            if (charIndex < spans.length) {
                const t = spans[charIndex];
                gsap.to(caret, { left: t.offsetLeft, top: t.offsetTop, height: t.offsetHeight, duration: 0.1 });
                const box = document.getElementById('test-area');
                if (t.offsetTop > box.offsetHeight / 2) gsap.to(wrapper, { y: -(t.offsetTop - box.offsetHeight / 2), duration: 0.3 });
                else gsap.to(wrapper, { y: 0, duration: 0.3 });
            }
        }

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && charIndex > 0) {
                charIndex--;
                const spans = wrapper.querySelectorAll('span');
                spans[charIndex].classList.remove('correct', 'wrong');
                streak = Math.max(0, streak - 1);
                streakDisplay.innerText = streak;
                const remainingText = targetText.slice(charIndex);
                wordsLeftDisplay.innerText = remainingText.trim() === "" ? 0 : remainingText.trim().split(/\s+/).length;
                positionCaret();
            }
        });

        input.addEventListener('input', (e) => {
            if (e.inputType === 'deleteContentBackward') return;
            if (!startTime) {
                startTime = Date.now();
                timerInterval = setInterval(() => {
                    const time = (Date.now() - startTime) / 60000;
                    wpmHistory.push(Math.round((charIndex / 5) / time) || 0);
                }, 1000);
            }
            const typed = input.value, spans = wrapper.querySelectorAll('span'), char = typed[typed.length - 1];
            if (charIndex < spans.length) {
                if (char === targetText[charIndex]) { spans[charIndex].classList.add('correct'); streak++; playClick(false); }
                else { spans[charIndex].classList.add('wrong'); errors++; streak = 0; playClick(true); }
                streakDisplay.innerText = streak;
                charIndex++; positionCaret();
                const remainingText = targetText.slice(charIndex);
                wordsLeftDisplay.innerText = remainingText.trim() === "" ? 0 : remainingText.trim().split(/\s+/).length;
                if (charIndex === targetText.length) showReport();
            }
        });

        function showReport() {
            clearInterval(timerInterval);
            const time = (Date.now() - startTime) / 60000;
            document.getElementById('final-wpm').innerText = Math.round((charIndex / 5) / time);
            document.getElementById('final-acc').innerText = Math.round(((charIndex - errors) / charIndex) * 100) + "%";
            document.getElementById('report-modal').style.display = 'flex';
            renderChart();
        }

        function renderChart() {
            const ctx = document.getElementById('wpmChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: wpmHistory.map((_, i) => i + 1),
                    datasets: [{
                        data: wpmHistory,
                        borderColor: '#00f3ff',
                        backgroundColor: 'rgba(0, 243, 255, 0.1)',
                        fill: true, tension: 0.4, pointRadius: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#666' } } } }
            });
        }

        function playClick(err) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
            osc.type = err ? 'square' : 'sine';
            osc.frequency.setValueAtTime(err ? 120 : 750, audioCtx.currentTime);
            gain.gain.setValueAtTime(parseFloat(volSlider.value), audioCtx.currentTime);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        document.body.addEventListener('click', (e) => { 
            const isClickable = e.target.closest('button') || e.target.closest('select') || e.target.closest('input') || e.target.closest('a');
            if (!isClickable) {
                input.focus(); 
            }
        });

        init();
    </script>
</body>
</html>
